#!/bin/bash

echo "ðŸ“¦ Memora åº”ç”¨æ‰“åŒ…å·¥å…·"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# 1. ç¼–è¯‘åº”ç”¨
echo "ðŸ”¨ ç¬¬ 1 æ­¥: ç¼–è¯‘åº”ç”¨..."
xcodebuild -project Memora.xcodeproj \
           -scheme Memora \
           -configuration Release \
           -derivedDataPath ./build \
           clean build

if [ $? -ne 0 ]; then
    echo "âŒ ç¼–è¯‘å¤±è´¥ï¼Œè¯·æ£€æŸ¥é¡¹ç›®æ˜¯å¦æ­£å¸¸"
    exit 1
fi

echo "âœ… ç¼–è¯‘æˆåŠŸï¼"
echo ""

# 2. æ‰¾åˆ°åº”ç”¨æ–‡ä»¶
APP_PATH="./build/Build/Products/Release/Memora.app"

if [ ! -d "$APP_PATH" ]; then
    echo "âŒ æ‰¾ä¸åˆ°ç¼–è¯‘çš„åº”ç”¨"
    exit 1
fi

# 3. åˆ›å»ºåˆ†äº«åŒ…
echo "ðŸ“¦ ç¬¬ 2 æ­¥: åˆ›å»ºåˆ†äº«åŒ…..."

SHARE_DIR="$HOME/Desktop/Memoraåˆ†äº«åŒ…"
rm -rf "$SHARE_DIR"
mkdir -p "$SHARE_DIR"

# å¤åˆ¶åº”ç”¨
cp -R "$APP_PATH" "$SHARE_DIR/"

# åˆ›å»ºå®‰è£…è¯´æ˜Ž
cat > "$SHARE_DIR/ðŸ“– å®‰è£…è¯´æ˜Ž.txt" << 'EOF'
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  Memora - EVA ä¸»é¢˜è®°äº‹æœ¬
  å®‰è£…å’Œä½¿ç”¨è¯´æ˜Ž
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ðŸ“± åº”ç”¨ä»‹ç»
-----------
Memora æ˜¯ä¸€æ¬¾åŸºäºŽã€Šæ–°ä¸–çºªç¦éŸ³æˆ˜å£«ã€‹EVA ä¸»é¢˜è®¾è®¡çš„
çŽ°ä»£åŒ– macOS è®°äº‹æœ¬åº”ç”¨ã€‚

âœ¨ ä¸»è¦ç‰¹æ€§
-----------
â€¢ EVA NERV é£Žæ ¼æ·±è‰²ä¸»é¢˜ï¼ˆåˆå·æœºé…è‰²ï¼‰
â€¢ æ”¯æŒå¤šä»»åŠ¡æ¸…å•ï¼Œæ¯ä¸ªä»»åŠ¡é¡¹å¯ç‹¬ç«‹å‹¾é€‰
â€¢ ä¼˜å…ˆçº§ç®¡ç†ï¼ˆé«˜/ä¸­/ä½Žï¼‰
â€¢ å®Œæ•´æ—¶é—´è®°å½•ï¼ˆå¹´-æœˆ-æ—¥ æ—¶:åˆ†ï¼‰
â€¢ å®žæ—¶è¿›åº¦æ˜¾ç¤º
â€¢ æœ¬åœ°æ•°æ®å­˜å‚¨ï¼Œéšç§å®‰å…¨


ðŸš€ å®‰è£…æ­¥éª¤
-----------

ç¬¬ 1 æ­¥: å®‰è£…åº”ç”¨

  1. å°†ã€ŒMemora.appã€æ‹–åˆ°ã€Œåº”ç”¨ç¨‹åºã€æ–‡ä»¶å¤¹
     ï¼ˆæ‰“å¼€ Finder â†’ å‰å¾€ â†’ åº”ç”¨ç¨‹åºï¼‰

ç¬¬ 2 æ­¥: é¦–æ¬¡æ‰“å¼€ï¼ˆé‡è¦ï¼ï¼‰

  âš ï¸ å› ä¸ºåº”ç”¨æ²¡æœ‰ Apple å¼€å‘è€…ç­¾åï¼Œé¦–æ¬¡æ‰“å¼€éœ€è¦ï¼š

  æ–¹æ³• Aï¼ˆæŽ¨èï¼‰:
    1. åœ¨ã€Œåº”ç”¨ç¨‹åºã€ä¸­æ‰¾åˆ° Memora
    2. å³é”®ç‚¹å‡» Memora
    3. é€‰æ‹©ã€Œæ‰“å¼€ã€ï¼ˆä¸æ˜¯åŒå‡»ï¼ï¼‰
    4. åœ¨å¼¹å‡ºå¯¹è¯æ¡†ä¸­ç‚¹å‡»ã€Œæ‰“å¼€ã€

  æ–¹æ³• Bï¼ˆå¦‚æžœæ–¹æ³• A ä¸è¡Œï¼‰:
    1. æ‰“å¼€ã€Œç³»ç»Ÿè®¾ç½®ã€
    2. è¿›å…¥ã€Œéšç§ä¸Žå®‰å…¨æ€§ã€
    3. å‘ä¸‹æ»šåŠ¨æ‰¾åˆ°ã€Œä»è¦æ‰“å¼€ã€æŒ‰é’®
    4. ç‚¹å‡»å¹¶è¾“å…¥å¯†ç 

ç¬¬ 3 æ­¥: å¼€å§‹ä½¿ç”¨

  âœ… å®Œæˆä»¥ä¸Šæ­¥éª¤åŽï¼Œä»¥åŽå¯ä»¥æ­£å¸¸åŒå‡»æ‰“å¼€ï¼


ðŸ’¡ ä½¿ç”¨æŠ€å·§
-----------

åˆ›å»ºè®°äº‹:
  ç‚¹å‡»å³ä¸Šè§’ã€Œ+ã€æŒ‰é’® â†’ è¾“å…¥æ ‡é¢˜ â†’ æ·»åŠ ä»»åŠ¡é¡¹ â†’ ä¿å­˜

å‹¾é€‰ä»»åŠ¡:
  åœ¨åˆ—è¡¨ä¸­ç›´æŽ¥ç‚¹å‡»ä»»åŠ¡é¡¹å‰çš„å…­è¾¹å½¢å›¾æ ‡å³å¯åˆ‡æ¢å®ŒæˆçŠ¶æ€

æŸ¥çœ‹è¿›åº¦:
  æ¯ä¸ªè®°äº‹å¡ç‰‡å³ä¸Šè§’æ˜¾ç¤ºå®Œæˆè¿›åº¦ï¼ˆå¦‚ï¼š75% [3/4]ï¼‰

ç¼–è¾‘è®°äº‹:
  ç‚¹å‡»è®°äº‹å¡ç‰‡ â†’ å³ä¸Šè§’èœå• â†’ ç¼–è¾‘

åˆ é™¤è®°äº‹:
  å·¦æ»‘è®°äº‹å¡ç‰‡ â†’ åˆ é™¤


â“ å¸¸è§é—®é¢˜
-----------

Q: ä¸ºä»€ä¹ˆç³»ç»Ÿè¯´"æ— æ³•éªŒè¯å¼€å‘è€…"ï¼Ÿ
A: è¿™æ˜¯æ­£å¸¸çš„ã€‚åº”ç”¨å®Œå…¨å®‰å…¨ï¼Œåªæ˜¯æ²¡æœ‰ä»˜è´¹çš„ Apple å¼€å‘è€…
   ç­¾åã€‚æŒ‰ã€Œé¦–æ¬¡æ‰“å¼€ã€æ­¥éª¤æ“ä½œå³å¯ã€‚

Q: æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ
A: åº”ç”¨ä½¿ç”¨ SwiftData æœ¬åœ°å­˜å‚¨ï¼Œæ•°æ®ä¿å­˜åœ¨ä½ çš„ Mac ä¸Šï¼Œ
   ä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚

Q: å¯ä»¥åœ¨å¤šå° Mac ä¸Šä½¿ç”¨å—ï¼Ÿ
A: å¯ä»¥ï¼å°†åº”ç”¨å¤åˆ¶åˆ°å…¶ä»– Mac ä¸Šå³å¯ã€‚ä½†æ¯å° Mac çš„æ•°æ®
   æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šè‡ªåŠ¨åŒæ­¥ã€‚

Q: åº”ç”¨æ˜¯å…è´¹çš„å—ï¼Ÿ
A: å®Œå…¨å…è´¹ï¼Œæ— å†…è´­ï¼Œæ— å¹¿å‘Šã€‚

Q: å¦‚ä½•å¸è½½ï¼Ÿ
A: ç›´æŽ¥åˆ é™¤ã€Œåº”ç”¨ç¨‹åºã€æ–‡ä»¶å¤¹ä¸­çš„ Memora å³å¯ã€‚


ðŸ“ž æŠ€æœ¯æ”¯æŒ
-----------

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·è”ç³»åˆ†äº«ç»™ä½ åº”ç”¨çš„äººã€‚

æˆ–è®¿é—®é¡¹ç›®é¡µé¢:
[å¦‚æžœæœ‰ GitHub åœ°å€ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ]


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ç¥ä½¿ç”¨æ„‰å¿«ï¼
  Enjoy your EVA-themed note-taking experience!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
EOF

echo "âœ… å®‰è£…è¯´æ˜Žå·²åˆ›å»º"
echo ""

# 4. åˆ›å»º ZIP åŽ‹ç¼©åŒ…
echo "ðŸ“¦ ç¬¬ 3 æ­¥: åˆ›å»º ZIP åŽ‹ç¼©åŒ…..."

cd "$HOME/Desktop"
zip -r "Memoraåˆ†äº«ç‰ˆ.zip" "Memoraåˆ†äº«åŒ…" -q

if [ $? -eq 0 ]; then
    echo "âœ… åŽ‹ç¼©åŒ…å·²åˆ›å»º"
    echo ""

    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤¹
    rm -rf "$SHARE_DIR"

    # æ˜¾ç¤ºç»“æžœ
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "ðŸŽ‰ æ‰“åŒ…å®Œæˆï¼"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    echo "ðŸ“¦ åˆ†äº«åŒ…ä½ç½®:"
    echo "   ~/Desktop/Memoraåˆ†äº«ç‰ˆ.zip"
    echo ""
    echo "ðŸ“ æ–‡ä»¶å¤§å°:"
    du -h "$HOME/Desktop/Memoraåˆ†äº«ç‰ˆ.zip" | awk '{print "   " $1}'
    echo ""
    echo "ðŸ“¤ åˆ†äº«æ–¹å¼:"
    echo "   â€¢ é€šè¿‡é‚®ä»¶å‘é€"
    echo "   â€¢ ä¸Šä¼ åˆ°ç½‘ç›˜ï¼ˆç™¾åº¦äº‘ã€é˜¿é‡Œäº‘ç›˜ç­‰ï¼‰"
    echo "   â€¢ é€šè¿‡å¾®ä¿¡/QQ å‘é€"
    echo "   â€¢ ä¸Šä¼ åˆ° GitHub Releases"
    echo ""
    echo "ðŸ’¡ æé†’å¯¹æ–¹:"
    echo "   è§£åŽ‹åŽæŸ¥çœ‹ã€ŒðŸ“– å®‰è£…è¯´æ˜Ž.txtã€"
    echo ""

    # è¯¢é—®æ˜¯å¦æ‰“å¼€æ¡Œé¢
    read -p "æ˜¯å¦çŽ°åœ¨æ‰“å¼€æ¡Œé¢æ–‡ä»¶å¤¹ï¼Ÿ(y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        open ~/Desktop
    fi
else
    echo "âŒ åˆ›å»ºåŽ‹ç¼©åŒ…å¤±è´¥"
    exit 1
fi
